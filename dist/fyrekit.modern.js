import{Controller as t}from"stimulus";import e from"flatpickr";import s from"dropzone";import{DirectUpload as i}from"@rails/activestorage";import a from"stimulus-flatpickr";import n from"highlight.js";import r from"imask";import{Modal as o,Toast as l}from"bootstrap";const c=require("lodash.debounce");class d extends t{connect(){this.toggleDropDown(!0),this.inputTarget.setAttribute("autocomplete","off"),this.inputTarget.setAttribute("spellcheck","false"),this.mouseDown=!1,this.onInputChange=c(this.onInputChange.bind(this),300),this.onResultsClick=this.onResultsClick.bind(this),this.onResultsMouseDown=this.onResultsMouseDown.bind(this),this.onInputBlur=this.onInputBlur.bind(this),this.onKeydown=this.onKeydown.bind(this),this.inputTarget.addEventListener("keydown",this.onKeydown),this.inputTarget.addEventListener("blur",this.onInputBlur),this.inputTarget.addEventListener("input",this.onInputChange),this.resultsTarget.addEventListener("mousedown",this.onResultsMouseDown),this.resultsTarget.addEventListener("click",this.onResultsClick)}disconnect(){this.inputTarget.removeEventListener("keydown",this.onKeydown),this.inputTarget.removeEventListener("focus",this.onInputFocus),this.inputTarget.removeEventListener("blur",this.onInputBlur),this.inputTarget.removeEventListener("input",this.onInputChange),this.resultsTarget.removeEventListener("mousedown",this.onResultsMouseDown),this.resultsTarget.removeEventListener("click",this.onResultsClick)}sibling(t){const e=Array.from(this.resultsTarget.querySelectorAll('[role="option"]')),s=this.resultsTarget.querySelector('[aria-selected="true"]'),i=e.indexOf(s);return(t?e[i+1]:e[i-1])||(t?e[0]:e[e.length-1])}select(t){for(const t of this.resultsTarget.querySelectorAll('[aria-selected="true"]'))t.removeAttribute("aria-selected"),t.classList.remove("active");t.setAttribute("aria-selected","true"),t.classList.add("active"),this.inputTarget.setAttribute("aria-activedescendant",t.id)}onKeydown(t){switch(t.key){case"Escape":this.resultsTarget.hidden||(this.toggleDropDown(!0),t.stopPropagation(),t.preventDefault());break;case"ArrowDown":{const e=this.sibling(!0);e&&this.select(e),t.preventDefault()}break;case"ArrowUp":{const e=this.sibling(!1);e&&this.select(e),t.preventDefault()}break;case"Tab":{const t=this.resultsTarget.querySelector('[aria-selected="true"]');t&&this.commit(t)}break;case"Enter":{const e=this.resultsTarget.querySelector('[aria-selected="true"]');e&&!this.resultsTarget.hidden&&(this.commit(e),t.preventDefault())}}}onInputFocus(){this.fetchResults()}onInputBlur(){this.mouseDown||this.toggleDropDown(!0)}commit(t){if("true"===t.getAttribute("aria-disabled"))return;if(t instanceof HTMLAnchorElement)return t.click(),this.hiddenTarget.value=t.dataset.autocompleteValue,this.inputTarget.value=t.innerHTML,void this.toggleDropDown(!0);const e=t.textContent.trim(),s=t.getAttribute("data-autocomplete-value")||e;this.inputTarget.value=e,this.hiddenTarget?this.hiddenTarget.value=s:this.inputTarget.value=s,this.element.dispatchEvent(new CustomEvent("autocomplete.change",{bubbles:!0,detail:{value:s,textValue:e}})),this.inputTarget.focus(),this.toggleDropDown(!0)}onResultsClick(t){if(t.preventDefault(),!(t.target instanceof Element))return;const e=t.target.closest('[role="option"]');e&&this.commit(e)}onResultsMouseDown(){this.mouseDown=!0,this.resultsTarget.addEventListener("mouseup",()=>this.mouseDown=!1,{once:!0})}onInputChange(t){this.hiddenTarget.value=t.target.value,this.element.removeAttribute("value"),this.fetchResults()}identifyOptions(){let t=0;for(const e of this.resultsTarget.querySelectorAll('[role="option"]:not([id])'))e.id="option-"+t++}fetchResults(){const t=this.inputTarget.value.trim();if(!t)return void this.toggleDropDown(!0);if(t.length<this.minLength)return void this.toggleDropDown(!0);if(this.items){this.filterItemResults(t),this.identifyOptions();const e=!!this.resultsTarget.querySelector('[role="option"]');return this.toggleDropDown(!e),this.element.dispatchEvent(new CustomEvent("load")),void this.element.dispatchEvent(new CustomEvent("loadend"))}const e=new URL(this.src,window.location.href),s=new URLSearchParams(e.search.slice(1));s.append("query",t),e.search=s.toString(),this.element.dispatchEvent(new CustomEvent("loadstart")),fetch(e.toString()).then(t=>t.text()).then(t=>{this.resultsTarget.innerHTML=t,this.identifyOptions();const e=!!this.resultsTarget.querySelector('[role="option"]');this.toggleDropDown(!e),this.element.dispatchEvent(new CustomEvent("load")),this.element.dispatchEvent(new CustomEvent("loadend"))}).catch(()=>{this.element.dispatchEvent(new CustomEvent("error")),this.element.dispatchEvent(new CustomEvent("loadend"))})}toggleDropDown(t){t?this.inputTarget.classList.remove("is-open"):this.inputTarget.classList.add("is-open"),this.resultsTarget.hidden=t}filterItemResults(t){const e=JSON.parse(this.items);this.resultsTarget.innerHTML="",e.filter(e=>e.substr(0,t.length).toUpperCase()==t.toUpperCase()).forEach((t,e)=>{this.resultsTarget.innerHTML+=`<li class="autocomplete-result" id="option-${e}" role="option" data-autocomplete-value="${e}">${t}</li>`})}get src(){return this.data.get("url")}get items(){return this.data.get("items")}get value(){return this.data.get("value")}get minLength(){const t=this.data.get("min-length");return t?parseInt(t,10):0}}d.targets=["input","hidden","results"];const h=require("braintree-web-drop-in");class u extends t{connect(){0!==this.totalValue?this.setupDropIn():(this.spinnerTarget.classList.remove("show"),this.buttonTarget.classList.remove("disabled"),this.element.classList.add("loaded"))}setupDropIn(){let t=this.element,e=this.spinnerTarget,s=this.buttonTarget,i=Number(this.totalValue).toFixed(2);h.create({authorization:this.tokenValue,container:"#payment",paypal:{flow:"checkout",amount:i,currency:"USD"}},(i,a)=>{a.isPaymentMethodRequestable()&&console.log("isPaymentMethodRequestable"),this.braintree=a;const n=setInterval(()=>{a&&(clearInterval(n),e.closest(".empty-state").classList.remove("show"),t.classList.add("loaded"))},10);a.on("paymentMethodRequestable",function(t){e.closest(".empty-state").classList.remove("show"),s.classList.remove("disabled")}),a.on("noPaymentMethodRequestable",function(){s.classList.add("disabled")})})}submit(t){t.preventDefault();let e=this.formTarget,s=this.buttonTarget,i=this.backTarget;i.classList.add("disabled"),s.classList.add("disabled"),s.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="visually-hidden">Loading...</span>',0===this.totalValue?e.submit():this.braintree.requestPaymentMethod((t,a)=>{if(t)return console.log("Error",t),s.innerHTML="Pay",i.classList.remove("disabled"),void s.classList.remove("disabled");document.querySelector("#payment_method_nonce").value=a.nonce,a.nonce?e.submit():console.error("There was an error with the payment information. Please try again")})}}u.targets=["button","back","container","form","spinner"],u.values={token:String,total:Number};const m=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});class g extends t{connect(){this.checkoutBtnTarget.classList.contains("disabled")||(this.checkoutBtnTarget.classList.add("disabled"),this.wrapperTarget.classList.add("d-none")),this.cartItems=[],this.updateTotals(),window.addEventListener("cart-item:changed",this.itemChanged.bind(this))}disconnect(){window.removeEventListener("cart-item:changed",this.itemChanged.bind(this))}itemChanged(t){const e=t.detail,s=this.cartItems.find(t=>t.ticket_type_id===e.ticket_type_id);if(s)0===e.quantity?this.cartItems=this.cartItems.filter(t=>t.ticket_type_id!==e.ticket_type_id):s.quantity=e.quantity;else{if(0==e.quantity)return;this.cartItems.push(e)}this.cartItems.length>0?this.checkoutBtnTarget.classList.remove("disabled"):this.checkoutBtnTarget.classList.add("disabled"),this.updateTotals()}updateTotals(){const t=this.cartItems.map(t=>t.quantity*t.price).reduce((t,e)=>Number(t)+Number(e||0),0),e=.03*t,s=e>0?e+.3:e,i=Number(t)+Number(s);this.subtotalTarget.innerHTML=m.format(t),this.feesTarget.innerHTML=m.format(s),this.totalTarget.innerHTML=m.format(i),0!==this.cartItems.length||this.wrapperTarget.classList.contains("d-none")?this.cartItems.length>0&&this.wrapperTarget.classList.remove("d-none"):this.wrapperTarget.classList.add("d-none")}}function p(){return(p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}g.targets=["checkoutBtn","fees","subtotal","total","wrapper"],g.values={items:Array,url:String};class T extends t{itemChanged(t){window.dispatchEvent(new CustomEvent("cart-item:changed",{detail:p({},this.dataValue,{quantity:Number(t.detail.data.text)})}))}}T.values={data:Object};class b extends t{connect(){let t=setInterval(()=>{this.daysTarget.classList.remove("changing"),this.hoursTarget.classList.remove("changing"),this.minutesTarget.classList.remove("changing"),this.secondsTarget.classList.remove("changing");let e=this.calculateCountdown();this.data.set("day",e.days),this.data.set("hour",e.hours),this.data.set("min",e.minutes),this.data.set("sec",e.seconds);const s=this.daysTarget.innerHTML!=e.days,i=this.hoursTarget.innerHTML!=e.hours,a=this.minutesTarget.innerHTML!=e.minutes,n=this.secondsTarget.innerHTML!=e.seconds;this.daysTarget.innerHTML=this.addLeadingZeros(e.days),this.hoursTarget.innerHTML=this.addLeadingZeros(e.hours),this.minutesTarget.innerHTML=this.addLeadingZeros(e.minutes),this.secondsTarget.innerHTML=this.addLeadingZeros(e.seconds),s&&this.daysTarget.classList.add("changing"),i&&this.hoursTarget.classList.add("changing"),a&&this.minutesTarget.classList.add("changing"),n&&this.secondsTarget.classList.add("changing"),this.distance<0&&clearInterval(t)},1e3)}calculateCountdown(){const t=new Date("Jul 5, 2021 08:00:00").getTime(),e=(new Date).getTime();this.distance=t-e;let s={days:0,hours:0,minutes:0,seconds:0};return s.days=Math.floor(this.distance/864e5),s.hours=Math.floor(this.distance%864e5/36e5),s.minutes=Math.floor(this.distance%36e5/6e4),s.seconds=Math.floor(this.distance%6e4/1e3),s}addLeadingZeros(t){let e=String(t);for(;e.length<2;)e="0"+t;return e}}b.targets=["days","hours","minutes","seconds"],b.value={endAt:String};class v extends t{get dateConfig(){return{altFormat:"m/d/Y",altInput:!0,appendTo:this.element.parentElement,clickOpens:!1,dateFormat:"Y-m-d",disableMobile:!0,positionElement:this.element.parentElement,onOpen:function(){this.jumpToDate(this.element.value),this.element.closest(`.${this.wrapperClass}.date`).classList.add("flatpickr-open")},onClose:()=>this.toggleDatePresentClass()}}get timeConfig(){return{altFormat:"h:i K",altInput:!0,appendTo:this.element.parentElement,clickOpens:!1,dateFormat:"Y-m-d h:i K",disableMobile:!0,enableTime:!0,noCalendar:!0,positionElement:this.element.parentElement,onOpen:function(){this.element.closest(`.${this.wrapperClass}.time`).classList.add("flatpickr-open")},onClose:()=>this.toggleDatePresentClass()}}get dateTimeConfig(){return{altFormat:"l, F j, Y @ h:i K",altInput:!0,appendTo:this.element.parentElement,clickOpens:!1,dateFormat:"Y-m-d h:i K",disableMobile:!0,enableTime:!0,positionElement:this.element.parentElement,onOpen:function(){this.element.closest(`.${this.wrapperClass}.date_time`).classList.add("flatpickr-open")},onClose:()=>this.toggleDatePresentClass()}}get wrapperClass(){return"floatingformbuilder"===this.wrapperValue?"form-floating":"form-group"}toggleDatePresentClass(){const t=this.element.closest("."+this.wrapperClass);this.element.value?t.classList.add("date-present"):t.classList.remove("date-present"),t.classList.remove("flatpickr-open")}get config(){switch(this.typeValue){case"date":return this.dateConfig;case"time":return this.timeConfig;default:return this.dateTimeConfig}}connect(){this.picker=e(this.element,this.config),this.toggleDatePresentClass(),this.element.nextSibling.onclick=function(t){this.picker.isOpen?this.picker.close():this.picker.open()}.bind(this)}disconnect(){this.picker.destroy(),this.picker=null}}v.values={type:String,wrapper:String};class f extends t{select(){this.isSelectedValue=!0;const t={id:this.idValue,value:this.textTarget.innerText.trim()},e=new CustomEvent("listItemSelected",{detail:t});window.dispatchEvent(e)}deselect(t){t.detail.value!==this.textTarget.innerText.trim()&&(this.isSelectedValue=!1)}}function y(t){const e=L(document.head,`meta[name="${t}"]`);if(e)return e.getAttribute("content")}function L(t,e){return"string"==typeof t&&(e=t,t=document),t.querySelector(e)}function w(t){t&&t.parentNode&&t.parentNode.removeChild(t)}f.targets=["text","item"],f.classes=["visibility"],f.values={isSelected:Boolean,id:Number},s.autoDiscover=!1;class x extends t{connect(){this.dropZone=new s(this.element,{url:this.url,headers:this.headers,maxFiles:this.maxFiles,maxFilesize:this.maxFileSize,acceptedFiles:this.acceptedFiles,addRemoveLinks:this.addRemoveLinks,autoQueue:!1}),this.hideFileInput(),this.bindEvents()}hideFileInput(){this.inputTarget.disabled=!0,this.inputTarget.style.display="none"}bindEvents(){this.dropZone.on("addedfile",t=>{setTimeout(()=>{t.accepted&&function(t,e){return new k(t,e)}(this,t).start()},500)}),this.dropZone.on("removedfile",t=>{t.controller&&w(t.controller.hiddenInput)}),this.dropZone.on("canceled",t=>{t.controller&&t.controller.xhr.abort()}),this.dropZone.on("processing",t=>{this.submitButton.disabled=!0}),this.dropZone.on("queuecomplete",t=>{this.submitButton.disabled=!1})}get headers(){return{"X-CSRF-Token":y("csrf-token")}}get url(){return this.inputTarget.getAttribute("data-direct-upload-url")}get maxFiles(){return this.data.get("maxFiles")||1}get maxFileSize(){return this.data.get("maxFileSize")||256}get acceptedFiles(){return this.data.get("acceptedFiles")}get addRemoveLinks(){return this.data.get("addRemoveLinks")||!0}get form(){return this.element.closest("form")}get submitButton(){return L(this.form,"input[type=submit], button[type=submit]")}}x.targets=["input","previews"];class k{constructor(t,e){this.directUpload=function(t,e,s){return new i(t,e,s)}(e,t.url,this),this.source=t,this.file=e}start(){this.file.controller=this,this.hiddenInput=this.createHiddenInput(),this.directUpload.create((t,e)=>{t?(w(this.hiddenInput),this.emitDropzoneError(t)):(this.hiddenInput.value=e.signed_id,this.emitDropzoneSuccess())})}createHiddenInput(){const t=document.createElement("input");var e;return t.type="hidden",t.name=this.source.inputTarget.name,(e=this.source.inputTarget).parentNode.insertBefore(t,e.nextSibling),t}directUploadWillStoreFileWithXHR(t){this.bindProgressEvent(t),this.emitDropzoneUploading()}bindProgressEvent(t){this.xhr=t,this.xhr.upload.addEventListener("progress",t=>this.uploadRequestDidProgress(t))}uploadRequestDidProgress(t){const e=t.loaded/t.total*100;L(this.file.previewTemplate,".dz-progress").style.width=e+"%",100==e&&L(this.file.previewTemplate,".dz-progress").classList.add("d-none")}emitDropzoneUploading(){this.file.status=s.UPLOADING,this.source.dropZone.emit("processing",this.file)}emitDropzoneError(t){this.file.status=s.ERROR,this.source.dropZone.emit("error",this.file,t),this.source.dropZone.emit("complete",this.file)}emitDropzoneSuccess(){this.file.status=s.SUCCESS,this.source.dropZone.emit("success",this.file),this.source.dropZone.emit("complete",this.file)}}class C extends a{change(t,e,s){s.input.classList.toggle("date-present")}}class E extends t{connect(){document.querySelectorAll("pre code").forEach(t=>{n.highlightBlock(t)})}}class D extends t{connect(){this.toggleList()}reset(){this.inputTarget.classList.toggle("show")}setText(t){t.detail.value&&(this.selectedTarget.classList.toggle("show"),this.inputTarget.classList.toggle("show"),this.textTarget.textContent=t.detail.value)}setSelected(t){this.toggleList(),t.detail.value&&(this.textTarget.textContent=t.detail.value)}toggleList(){this.listTarget.classList.toggle(this.visibilityClass)}}D.targets=["text","selected","input","list"],D.classes=["visibility"];const S=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2});class I extends t{connect(){this.update()}update(){this.subtotal=0,this.total=0,this.taxRate=0,this.taxes=0,this.referenceTargets.forEach(t=>{this.subtotal+=Number(t.value)}),this.taxes=this.subtotal*this.taxRate,this.total=this.subtotal+this.taxes,this.populate()}populate(){this.taxesTarget.innerHTML=S.format(this.taxes),this.subtotalTarget.innerHTML=S.format(this.subtotal),this.totalTarget.innerHTML=S.format(this.total)}}I.targets=["total","subtotal","taxes","reference"],I.values={taxRate:Number};class q extends t{connect(){this.item=this.itemValue,this.item.quantity=this.item.quantity||1,this.item.costCents=this.item.costCents?this.item.costCents/100:0,this.validate()}get item(){return self.item}set item(t){self.item=t}addProduct(t){const e=JSON.parse(t.target.dataset.autocompleteItem);this.item.costCents=e.price_cents/100,this.item.productId=e.id,this.priceTarget.disabled=!1,this.quantityTarget.disabled=!1,this.populate()}validate(t){this.itemValue.productId&&"Backspace"!=(null==t?void 0:t.key)||(this.quantityTarget.value=1,this.priceTarget.value=null,this.quantityTarget.value=null,this.priceTarget.disabled=!0,this.quantityTarget.disabled=!0,"Backspace"==(null==t?void 0:t.key)&&(this.item.productId=null))}update(t){this.item["price"==t.target.dataset.lineItemTarget?"costCents":"quantity"]=Number(t.target.value),this.populate()}populate(){this.quantityTarget.value=Number(this.item.quantity),this.priceTarget.value=Number(this.item.costCents).toFixed(2),this.totalTarget.value=Number(this.item.costCents*this.item.quantity).toFixed(2)}}q.targets=["productId","price","quantity","total"],q.values={item:Object};const M={pounds:"‎£",euro:"‎€",dollar:"$"};class H extends t{connect(){r(this.element,this.config)}get config(){return"number"===this.typeValue?this.numberConfig:"phone"===this.typeValue?this.phoneConfig:this.moneyConfig}get numberConfig(){return{mask:Number,scale:2,signed:!1,thousandsSeparator:",",padFractionalZeros:!1,normalizeZeros:!0,radix:",",mapToRadix:["."],min:0}}get moneyConfig(){const t="euro"===this.optionsValue.currency;return{mask:M[this.optionsValue.currency||"dollar"]+"num",lazy:!1,blocks:{num:{mask:Number,thousandsSeparator:t?".":",",placeholderChar:"#",lazy:!1,scale:2,signed:!1,padFractionalZeros:!1,normalizeZeros:!1,radix:t?",":".",mapToRadix:t?[","]:["."]}}}}get phoneConfig(){return{mask:[{mask:"+{1} (000) 000-0000",startsWith:"",country:"Default"},{mask:"+44 000 0000 0000",startsWith:"44",lazy:!1,country:"United Kingdom"},{mask:"99 99 9999 9999",startsWith:"",lazy:!1,country:"Mexico"}]}}}H.values={type:String,options:Object};class R extends t{open(t){fetch(this.urlValue).then(t=>t.text()).then(t=>{document.body.innerHTML+=t,this.modal=new bootstrap.Modal(document.getElementById(this.idValue),{}),this.modal.show()}).catch(t=>{console.log("modal:error",t)})}}R.values={url:String,id:String};class F extends t{connect(){window.onscroll=()=>{window.scrollY>=60?this.element.classList.add("shrink"):this.element.classList.remove("shrink")}}}class A extends t{add(t){t.preventDefault();var e=this.templateTarget.innerHTML.replace(/NEW_RECORD/g,(new Date).getTime());this.linksTarget.insertAdjacentHTML("beforebegin",e)}remove(t){t.preventDefault();let e=t.target.closest(".nested-form-item");"true"!=e.dataset.newRecord?(e.querySelector("input[name*='_destroy']").value=1,e.style.display="none"):e.remove()}}A.targets=["links","template"];class N extends t{initialize(){this.reset()}connect(){var t;this.defaultText=null==(t=this.inputTarget.options[this.inputTarget.selectedIndex])?void 0:t.text,this.buttonTarget.innerText=this.defaultText,this.selectedItem=this.listTarget.querySelector(`[data-text='${this.defaultText}']`),document.addEventListener("click",t=>{!this.element.contains(t.target)&&this.listTarget.classList.contains("show")&&this.toggle(t)})}disconnect(){this.defaultText=null,this.selectedItem=null}toggle(t){t.preventDefault();const e=this.listTarget;e.classList.toggle("show"),this.buttonTarget.setAttribute("aria-expanded",e.classList.contains("show"))}keyPressed(t){switch(t.key){case"ArrowUp":case"ArrowDown":this.focusNextListItem(t.key);break;case"Enter":this.submitForm(this.listTarget.querySelector("li.focused").dataset.id);break;case"Escape":this.close()}}focusNextListItem(t){let e=this.listTarget.querySelector("li#"+this.listTarget.getAttribute("aria-activedescendant"));const s=Array.prototype.indexOf.call(this.listTarget.childNodes,e);let i;if("ArrowDown"===t&&s<this.listTarget.childElementCount-1)i=1;else{if(!("ArrowUp"===t&&s>0))return;i=-1}e=this.listTarget.children[s+i],this.listTarget.querySelector("li.focused").classList.remove("focused"),e.classList.add("focused"),this.listTarget.setAttribute("aria-activedescendant",e.id),e.focus()}itemSelected(t){this.buttonTarget.innerText=t.target.dataset.text,this.toggle(t),this.inputTarget.dispatchEvent(new CustomEvent("select:value-changed",{detail:{data:t.target.dataset,origin:t.target}})),this.submitForm(t.target.dataset.id)}submitForm(t){const e=this.element.closest("form");this.inputTarget.value=t,this.submitValue&&e&&e.requestSubmit()}close(){this.listTarget.classList.toggle("show"),this.buttonTarget.setAttribute("aria-expanded",this.listTarget.classList.contains("show")),this.listTarget.querySelector("li.focused").classList.remove("focused"),this.reset()}reset(){var t,e;this.buttonTarget.setAttribute("aria-expanded",this.listTarget.classList.contains("open"));const s=this.inputTarget.options[this.inputTarget.selectedIndex].value;this.listTarget.setAttribute("aria-activedescendant","option-"+s),null==(t=this.listTarget.querySelector("li#option-"+s))||null==(e=t.classList)||e.add("focused")}}N.targets=["input","button","list"],N.values={submit:Boolean};class B extends t{connect(){}get path(){return this.data.get("path")}resetTimeout(){clearTimeout(this.heartbeat),this.timeout=(new Date).getTime()+1e3*this.data.get("timeout"),this.startHeartbeat()}startHeartbeat(){this.heartbeat=setTimeout(()=>this.heartbeatCheck(),5e3)}heartbeatCheck(){if((new Date).getTime()>this.timeout){if(document.getElementById("timeout-modal"))return;this.fetchSessionTimeout()}else this.startHeartbeat()}fetchSessionTimeout(){fetch(this.path,{method:"get"}).then(t=>t.text()).then(t=>{document.body.innerHTML+=t,this.modal=o(document.getElementById("timeout-modal"),{keyboard:!1,focus:!0,backdrop:"static"}),this.modal.show()}).finally(()=>clearTimeout(this.heartbeat)).catch(t=>{console.log("fetchSessionTimeout:error",t),document.body.innerHTML+='\n          <div class="toast toast-timeout d-flex align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">\n            <div class="toast-body">Unable to process session timeout modal.</div>\n            <button type="button" class="btn-close btn-close-white ms-auto me-2" data-bs-dismiss="toast" aria-label="Close"></button>\n          </div>\n        ';const e=document.querySelector(".toast-timeout");new l(e,{autohide:!0}).show()})}success(t){if(t.detail.success){let t=document.getElementById("timeout-modal");o.getInstance(t).toggle(),t.remove(),this.resetTimeout()}else document.querySelector("#timeout-modal .alert").classList.remove("d-none"),document.getElementById("user_password").value=""}}class z extends t{toggle(){this.sidebarTarget.classList.toggle("active"),this.element.classList.toggle("sidebar-active"),this.togglerTarget.classList.toggle("fa-times"),this.togglerTarget.classList.toggle("fa-bars")}}z.targets=["sidebar","toggler"];class O extends t{connect(){let t=Stripe(this.data.get("key")),e=t.elements().create("card",{style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}});e.mount(this.cardElementTarget);let s=this;e.addEventListener("change",t=>{s.cardErrorsTarget.textContent=t.error?t.error.message:""});let i=s.element;i.addEventListener("submit",a=>{a.preventDefault();const n=i.querySelector("button.btn-primary");n.classList.add("disabled"),n.innerHTML='<i class="fas fa-circle-notch fa-spin"></i>',t.createToken(e).then(t=>{if(t.error)return this.cardErrorsTarget.textContent=t.error.message,n.innerHTML="Start Now",void n.classList.remove("disabled");s.stripeTokenHandler(t.token)})})}stripeTokenHandler(t){let e=this.element;["stripe_token","last4","exp_month","exp_year","brand"].forEach(s=>{let i=document.createElement("input");const a="stripe_token"===s?s:"card_"+s,n="stripe_token"===s?t.id:t.card[s];i.setAttribute("type","hidden"),i.setAttribute("name",`subscription[${a}]`),i.setAttribute("value",n),e.appendChild(i)}),e.submit()}show(t){const e=document.querySelector(`label[for="${t.target.id}"] .btn`);document.querySelector(".payment-fields .text-primary .amount").innerHTML=`&nbsp;$${e.dataset.price}&nbsp;`}}O.targets=["cardElement","cardErrors"];class _ extends t{connect(){new l(this.element,{}).show()}}export{d as Autocomplete,u as BraintreeCheckout,g as Cart,T as CartItem,b as Countdown,v as DateTimeInput,f as DropdownItem,x as Dropzone,C as Flatpickr,E as Highlight,D as InputDropdown,I as Invoice,q as LineItem,H as Mask,R as Modal,F as Navbar,A as NestedForm,N as Select,B as Session,z as Sidebar,O as Stripe,_ as Toast};
//# sourceMappingURL=fyrekit.modern.js.map
